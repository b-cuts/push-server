<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns:th="http://www.thymeleaf.org">
  <!--@thymesVar id="it" type="com.cosmicpush.app.resources.manage.client.userevents.UserEventSessionsModel"-->
  <head th:include="fragments::html_header" th:with="pageTitle=': User Event'">

    <script type="text/javascript">
      function showTraits(id) {
        $("#traits-"+id).css("display", "table");
        $("#show-"+id).css("display", "none");
        $("#hide-"+id).css("display", "inline");
        return false;
      }
      function hideTraits(id) {
        $("#traits-"+id).css("display", "none");
        $("#show-"+id).css("display", "inline");
        $("#hide-"+id).css("display", "none");
        return false;
      }
    </script>
    <style type="text/css">
      .traits-table {
        display: none;
      }
    </style>
  </head>
  <body>
    <div style="float: right" th:include="fragments::page_title"></div>

    <h1 th:text="|${it.domain.domainKey}: User Events|"></h1>
    <div th:include="fragments::client_sub_menu"></div>
    <div style="clear:both"></div>

    <table class="requests-table" style="width: 100%; margin-top: 1em">
      <thead>
        <tr>
          <th th:text="|Device ID: ${it.deviceId}|"></th>
        </tr>
      </thead>
    </table>

    <table class="requests-table" style="width: 100%; margin-top: 1em" th:each="session : ${it.sessions}">

      <colgroup>
        <col style="width:1em"/>
        <col/>
        <col style="width:1em"/>
      </colgroup>

      <thead>
        <tr>
          <th colspan="3">
            <table>
              <tr>
                <th><label>User Name:&nbsp;</label></th>
                <th th:text="${session.userName}"></th>
              </tr>
              <tr>
                <th><label>IP Address:&nbsp;</label></th>
                <th th:text="${session.ipAddress}"></th>
              </tr>
              <tr th:if="${session.ipAddress != session.hostAddress}">
                <th><label>Host Address:&nbsp;</label></th>
                <th th:text="${session.hostAddress}"></th>
              </tr>
              <tr>
                <th><label>Session ID:&nbsp;</label></th>
                <th th:text="${session.sessionId}"></th>
              </tr>
              <tr th:if="${session.userAgent != null}">
                <th><label>${session.userAgent.agentType}:&nbsp;</label></th>
                <th>${session.userAgent.agentName} ${session.userAgent.agentVersion}</th>
              </tr>
              <tr th:if="${session.userAgent != null}">
                <th>${session.userAgent.osType}:</th>
                <th>${session.userAgent.osName} ${session.userAgent.osVersionNumber}</th>
              </tr>
            </table>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr th:each="pushRequest : ${session.pushRequests}">
          <td th:text="${#temporals.format(pushRequest.createdAt, 'MM-dd-yy hh:mm a')}"></td>
          <td style="border-right:0">
            <div th:text="${pushRequest.userEventPush.message}"></div>
            <div th:include="fragments::push_traits" th:with="pushTraits=${pushRequest.pushTraits}"></div>
          </td>
          <td style="padding-right: 5px; border-left:0">
<!--
            <th:block th:if="${pushRequest.userEventPush.traits.size() > 0}">
              <a id="'show-'+${pushRequest.key}" href="#" style="color: inherit; text-decoration: none"                th:onclick="'return showTraits(\''+${pushRequest.key}+'\')'">&uarr;&uarr;&uarr;</a>
              <a th:id="|hide-${pushRequest.key}|" href="#" style="color: inherit; text-decoration: none; display: none" th:onclick="|return hideTraits('${pushRequest.key}')|">&darr;&darr;&darr;</a>
            </th:block>
-->
          </td>
        </tr>
      </tbody>

    </table>
  </body>
</html>